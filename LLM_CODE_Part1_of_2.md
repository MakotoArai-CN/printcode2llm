<!--
  Generated by PrintCode2LLM (ptlm)
  Project: printcode2llm
  Date: 2025-11-13T19:37:12+08:00
  Part: 1 of 2
  Files: 1-15
-->

# printcode2llm

## é˜…è¯»é¡»çŸ¥

è¿™æ˜¯ä¸€ä¸ªé¡¹ç›®æºç æ•´ç†æ–‡æ¡£ï¼ŒåŒ…å«å®Œæ•´çš„ä»£ç æ–‡ä»¶ã€‚

**å¤„ç†å»ºè®®ï¼š**
- å¦‚éœ€ä¿®æ”¹ä»£ç ï¼Œè¯·ä¿æŒåŸæœ‰ç»“æ„å’Œæ³¨é‡Š
- é™¤éæ˜ç¡®è¦æ±‚ï¼Œå¦åˆ™åªåšå¿…è¦çš„æ”¹åŠ¨
- è¿”å›ä»£ç æ—¶ä½¿ç”¨å®Œæ•´å®ç°ï¼Œé¿å…çœç•¥
- ä¿æŒåŸé¡¹ç›®çš„åŠŸèƒ½å’Œç•Œé¢ä¸å˜

**ä»£ç è§„èŒƒï¼š**
- ç¦æ­¢ä½¿ç”¨ "// ... ä¿æŒä¸å˜" ç­‰çœç•¥å†™æ³•
- ç¦æ­¢ä½¿ç”¨ "// ... å…¶ä»–ä»£ç " ç­‰ç®€åŒ–è¡¨è¾¾
- ç®—æ³•å®ç°å¿…é¡»å®Œæ•´ï¼Œä¸å¾—ç¼©å‡
- å¦‚æœä»£ç è¿‡é•¿ï¼Œåˆ†æ‰¹æ¬¡å®Œæ•´è¿”å›


## é¡¹ç›®æ¦‚å†µ

- **é¡¹ç›®åç§°**: printcode2llm
- **ç”Ÿæˆæ—¶é—´**: 2025-11-13 19:37:12
- **æ–‡ä»¶æ€»æ•°**: 24 ä¸ªï¼ˆä»£ç : 20, é…ç½®: 4ï¼‰
- **æ€»è¡Œæ•°**: 4,124 è¡Œ
- **æ€»å­—ç¬¦æ•°**: 95,757 å­—ç¬¦
- **å‹ç¼©æ¨¡å¼**: æ ‡å‡†å‹ç¼©

> âš ï¸ **æ³¨æ„**: æ³¨æ„ï¼šä»£ç å·²ç»è¿‡å‹ç¼©å¤„ç†ï¼Œå»ºè®®ä½¿ç”¨å‰å…ˆæ ¼å¼åŒ–ã€‚


## ç›®å½•ç»“æ„

```tree
printcode2llm/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ ptlm/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ default.yaml
â”‚   â””â”€â”€ prompts.yaml
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â”œâ”€â”€ config.go
â”‚   â”‚   â”œâ”€â”€ install.go
â”‚   â”‚   â”œâ”€â”€ linux_helper.go
â”‚   â”‚   â”œâ”€â”€ root.go
â”‚   â”‚   â”œâ”€â”€ uninstall.go
â”‚   â”‚   â”œâ”€â”€ update.go
â”‚   â”‚   â”œâ”€â”€ version.go
â”‚   â”‚   â””â”€â”€ windows_helper.go
â”‚   â”œâ”€â”€ compress/
â”‚   â”‚   â””â”€â”€ compress.go
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”œâ”€â”€ generator/
â”‚   â”‚   â”œâ”€â”€ segment.go
â”‚   â”‚   â””â”€â”€ tree.go
â”‚   â”œâ”€â”€ scanner/
â”‚   â”‚   â”œâ”€â”€ ignore.go
â”‚   â”‚   â””â”€â”€ scanner.go
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ banner.go
â”‚   â”‚   â””â”€â”€ color.go
â”‚   â””â”€â”€ version/
â”‚       â””â”€â”€ version.go
â”œâ”€â”€ .ptlm.yaml
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ go.mod
â”œâ”€â”€ ptlm.exe
â””â”€â”€ ptlm.png
```

## æºç æ¸…å•

### 1. .ptlm.yaml

```yaml
language_map:
    .bash: shell
    .c: c
    .cpp: cpp
    .css: css
    .dart: dart
    .go: go
    .h: c
    .hpp: cpp
    .html: html
    .ini: ini
    .java: java
    .js: javascript
    .json: json
    .jsx: javascript
    .kt: kotlin
    .less: less
    .md: markdown
    .php: php
    .ps1: powershell
    .py: python
    .rb: ruby
    .rs: rust
    .scss: scss
    .sh: shell
    .sql: sql
    .svelte: svelte
    .swift: swift
    .toml: toml
    .ts: typescript
    .tsx: typescript
    .txt: text
    .vue: vue
    .xml: xml
    .yaml: yaml
    .yml: yaml
default_ignore:
    - node_modules
    - vendor
    - venv
    - .venv
    - env
    - .env
    - __pycache__
    - .git
    - .svn
    - .hg
    - .vscode
    - .idea
    - .vs
    - .eclipse
    - dist
    - dist-*
    - build
    - out
    - bin
    - target
    - coverage
    - .gradle
    - .DS_Store
    - Thumbs.db
    - desktop.ini
    - assets
    - static
    - public
    - doc
    - docs
    - package-lock.json
    - yarn.lock
    - Gemfile.lock
    - Cargo.lock
    - go.sum
    - '*.log'
    - logs
    - tmp
    - temp
    - .cache
    - '*.tmp'
    - '*.bak'
    - '*.swp'
    - '*.swo'
    - '*.swn'
    - '*.old'
    - LLM_CODE*.md
binary_extensions:
    - .jpg
    - .jpeg
    - .png
    - .gif
    - .bmp
    - .svg
    - .ico
    - .webp
    - .tiff
    - .tif
    - .psd
    - .ai
    - .eps
    - .raw
    - .cr2
    - .nef
    - .heic
    - .heif
    - .mp4
    - .avi
    - .mov
    - .wmv
    - .flv
    - .mkv
    - .webm
    - .m4v
    - .3gp
    - .mpg
    - .mpeg
    - .vob
    - .ogv
    - .mp3
    - .wav
    - .ogg
    - .flac
    - .aac
    - .m4a
    - .wma
    - .ape
    - .alac
    - .opus
    - .mid
    - .midi
    - .pdf
    - .doc
    - .docx
    - .ppt
    - .pptx
    - .xls
    - .xlsx
    - .odt
    - .ods
    - .odp
    - .pages
    - .numbers
    - .key
    - .zip
    - .tar
    - .gz
    - .rar
    - .7z
    - .iso
    - .dmg
    - .tgz
    - .bz2
    - .xz
    - .cab
    - .deb
    - .rpm
    - .pkg
    - .msi
    - .exe
    - .dll
    - .so
    - .dylib
    - .lib
    - .a
    - .app
    - .bat
    - .cmd
    - .com
    - .jar
    - .war
    - .ear
    - .apk
    - .ipa
    - .aab
    - .aar
    - .nupkg
    - .snap
    - .pth
    - .pt
    - .onnx
    - .pb
    - .tflite
    - .h5
    - .hdf5
    - .caffemodel
    - .mlmodel
    - .savedmodel
    - .pyc
    - .pyd
    - .o
    - .obj
    - .class
    - .wasm
    - .elc
    - .rbc
    - .ttf
    - .otf
    - .woff
    - .woff2
    - .eot
    - .fon
    - .fnt
    - .db
    - .sqlite
    - .sqlite3
    - .mdb
    - .accdb
    - .frm
    - .ibd
    - .dbf
    - .parquet
    - .feather
    - .arrow
    - .avro
    - .protobuf
    - .msgpack
    - .pickle
    - .pkl
    - .npy
    - .npz
    - .mat
    - .rds
    - .rda
    - .RData
non_code_extensions:
    - .md
    - .txt
    - .log
    - .csv
    - .json
    - .xml
    - .yml
    - .yaml
    - .toml
    - .ini
    - .conf
    - .config
custom_ignore:
    patterns: []
    regex: []
output:
    max_chars: 50000
    compress: true
    ultra_compress: false
    split_mode: file
    include_tree: true
    output_prefix: LLM_CODE
prompts:
    section_info: é¡¹ç›®æ¦‚å†µ
    section_tree: ç›®å½•ç»“æ„
    section_code: æºç æ¸…å•
    section_stats: æ•°æ®ç»Ÿè®¡
    header_prompt: |
        ## é˜…è¯»é¡»çŸ¥

        è¿™æ˜¯ä¸€ä¸ªé¡¹ç›®æºç æ•´ç†æ–‡æ¡£ï¼ŒåŒ…å«å®Œæ•´çš„ä»£ç æ–‡ä»¶ã€‚

        **å¤„ç†å»ºè®®ï¼š**
        - å¦‚éœ€ä¿®æ”¹ä»£ç ï¼Œè¯·ä¿æŒåŸæœ‰ç»“æ„å’Œæ³¨é‡Š
        - é™¤éæ˜ç¡®è¦æ±‚ï¼Œå¦åˆ™åªåšå¿…è¦çš„æ”¹åŠ¨
        - è¿”å›ä»£ç æ—¶ä½¿ç”¨å®Œæ•´å®ç°ï¼Œé¿å…çœç•¥
        - ä¿æŒåŸé¡¹ç›®çš„åŠŸèƒ½å’Œç•Œé¢ä¸å˜

        **ä»£ç è§„èŒƒï¼š**
        - ç¦æ­¢ä½¿ç”¨ "// ... ä¿æŒä¸å˜" ç­‰çœç•¥å†™æ³•
        - ç¦æ­¢ä½¿ç”¨ "// ... å…¶ä»–ä»£ç " ç­‰ç®€åŒ–è¡¨è¾¾
        - ç®—æ³•å®ç°å¿…é¡»å®Œæ•´ï¼Œä¸å¾—ç¼©å‡
        - å¦‚æœä»£ç è¿‡é•¿ï¼Œåˆ†æ‰¹æ¬¡å®Œæ•´è¿”å›
    compress_notice: |
        æ³¨æ„ï¼šä»£ç å·²ç»è¿‡å‹ç¼©å¤„ç†ï¼Œå»ºè®®ä½¿ç”¨å‰å…ˆæ ¼å¼åŒ–ã€‚
    ultra_compress_notice: |
        æ³¨æ„ï¼šä»£ç å·²ç»è¿‡æ·±åº¦å‹ç¼©ï¼Œä½¿ç”¨å‰å¿…é¡»æ ¼å¼åŒ–ï¼Œå¦åˆ™å¯è¯»æ€§è¾ƒå·®ã€‚
    continue_notice: |
        å½“å‰å†…å®¹æœªå®Œï¼Œè¯·ç­‰å¾…åç»­éƒ¨åˆ†ã€‚
    complete_notice: |
        å…¨éƒ¨å†…å®¹å·²å±•ç¤ºå®Œæ¯•ã€‚
    project_separator: |4
        ---

        ä»¥ä¸Šæ˜¯é¡¹ç›® **%s** çš„å®Œæ•´å†…å®¹ã€‚

        ---
    file_info_format: '**ç±»å‹**: %s | **è¡Œæ•°**: %d | **å¤§å°**: %s'
    non_code_file_notice: æ­¤æ–‡ä»¶ä¸ºé…ç½®/æ–‡æ¡£ç±»å‹ï¼Œéå¯æ‰§è¡Œä»£ç 
    binary_file_skip: è·³è¿‡äºŒè¿›åˆ¶æ–‡ä»¶
    stats_table_header: |
        | æŒ‡æ ‡ | æ•°å€¼ |
        |------|------|
    usage_instructions: |
        ## ä½¿ç”¨è¯´æ˜

        1. æœ¬æ–‡æ¡£å…±åˆ†ä¸º %d ä¸ªéƒ¨åˆ†
        2. è¯·æŒ‰é¡ºåºå‘é€ç»™ AI åŠ©æ‰‹
        3. æ¯ä¸ªéƒ¨åˆ†å¯ç‹¬ç«‹é˜…è¯»ï¼Œå†…å®¹è¿ç»­
        4. å»ºè®®å¼€å§‹æ—¶è¯´æ˜è¿™æ˜¯åˆ†æ®µå‘é€çš„é¡¹ç›®ä»£ç 
```

### 2. Makefile

```text
BINARY_NAME=ptlm
MAIN_PATH=cmd/ptlm/main.go
BUILD_DIR=build
VERSION=1.0.0
LDFLAGS=-ldflags "-s -w -X printcode2llm/internal/version.Version=$(VERSION)"
ifeq ($(OS),Windows_NT)
    DETECTED_OS := Windows
    RM := cmd /C del /Q /F
    RMDIR := cmd /C rmdir /S /Q
    MKDIR := cmd /C mkdir
    EXE := .exe
    SEP := \\
else
    DETECTED_OS := $(shell uname -s)
    RM := rm -f
    RMDIR := rm -rf
    MKDIR := mkdir -p
    EXE :=
    SEP := /
endif
.PHONY: all clean install help test run \
        windows linux darwin \
        windows-386 windows-amd64 windows-arm64 \
        linux-386 linux-amd64 linux-arm linux-arm64 linux-loong64 \
        darwin-amd64 darwin-arm64
all: windows linux darwin
	@echo All platforms compiled successfully!
	@echo Output directory: $(BUILD_DIR)$(SEP)
windows: windows-386 windows-amd64 windows-arm64
linux: linux-386 linux-amd64 linux-arm linux-arm64 linux-loong64
darwin: darwin-amd64 darwin-arm64
ifeq ($(DETECTED_OS),Windows)
windows-386:
	@echo Building Windows 32-bit...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=windows&& set GOARCH=386&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-windows-386.exe $(MAIN_PATH)
windows-amd64:
	@echo Building Windows 64-bit...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=windows&& set GOARCH=amd64&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-windows-amd64.exe $(MAIN_PATH)
windows-arm64:
	@echo Building Windows ARM64...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=windows&& set GOARCH=arm64&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-windows-arm64.exe $(MAIN_PATH)
linux-386:
	@echo Building Linux 32-bit...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=linux&& set GOARCH=386&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-linux-386 $(MAIN_PATH)
linux-amd64:
	@echo Building Linux 64-bit...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=linux&& set GOARCH=amd64&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-linux-amd64 $(MAIN_PATH)
linux-arm:
	@echo Building Linux ARM...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=linux&& set GOARCH=arm&& set GOARM=7&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-linux-arm $(MAIN_PATH)
linux-arm64:
	@echo Building Linux ARM64...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=linux&& set GOARCH=arm64&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-linux-arm64 $(MAIN_PATH)
linux-loong64:
	@echo Building Linux LoongArch64...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=linux&& set GOARCH=loong64&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-linux-loong64 $(MAIN_PATH)
darwin-amd64:
	@echo Building macOS Intel...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=darwin&& set GOARCH=amd64&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-darwin-amd64 $(MAIN_PATH)
darwin-arm64:
	@echo Building macOS Apple Silicon...
	@if not exist $(BUILD_DIR) mkdir $(BUILD_DIR)
	@set GOOS=darwin&& set GOARCH=arm64&& go build $(LDFLAGS) -o $(BUILD_DIR)$(SEP)$(BINARY_NAME)-darwin-arm64 $(MAIN_PATH)
else
windows-386:
	@echo "Building Windows 32-bit..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=windows GOARCH=386 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-windows-386.exe $(MAIN_PATH)
windows-amd64:
	@echo "Building Windows 64-bit..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=windows GOARCH=amd64 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-windows-amd64.exe $(MAIN_PATH)
windows-arm64:
	@echo "Building Windows ARM64..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=windows GOARCH=arm64 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-windows-arm64.exe $(MAIN_PATH)
linux-386:
	@echo "Building Linux 32-bit..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=linux GOARCH=386 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-linux-386 $(MAIN_PATH)
linux-amd64:
	@echo "Building Linux 64-bit..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=linux GOARCH=amd64 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-linux-amd64 $(MAIN_PATH)
linux-arm:
	@echo "Building Linux ARM..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=linux GOARCH=arm GOARM=7 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-linux-arm $(MAIN_PATH)
linux-arm64:
	@echo "Building Linux ARM64..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=linux GOARCH=arm64 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-linux-arm64 $(MAIN_PATH)
linux-loong64:
	@echo "Building Linux LoongArch64..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=linux GOARCH=loong64 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-linux-loong64 $(MAIN_PATH)
darwin-amd64:
	@echo "Building macOS Intel..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=darwin GOARCH=amd64 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-darwin-amd64 $(MAIN_PATH)
darwin-arm64:
	@echo "Building macOS Apple Silicon..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=darwin GOARCH=arm64 go build $(LDFLAGS) -o $(BUILD_DIR)/$(BINARY_NAME)-darwin-arm64 $(MAIN_PATH)
endif
build-local:
	@echo "Building for current platform..."
	@go build $(LDFLAGS) -o $(BINARY_NAME)$(EXE) $(MAIN_PATH)
	@echo "Build complete: ./$(BINARY_NAME)$(EXE)"
install: build-local
	@echo "Installing to system..."
	@./$(BINARY_NAME)$(EXE) install
ifeq ($(DETECTED_OS),Windows)
clean:
	@echo Cleaning build files...
	@if exist $(BUILD_DIR) rmdir /S /Q $(BUILD_DIR)
	@if exist $(BINARY_NAME).exe del /Q /F $(BINARY_NAME).exe
	@if exist LLM_CODE*.md del /Q /F LLM_CODE*.md
	@echo Clean complete
else
clean:
	@echo "Cleaning build files..."
	@rm -rf $(BUILD_DIR)
	@rm -f $(BINARY_NAME)
	@rm -f LLM_CODE*.md
	@echo "Clean complete"
endif
test:
	@echo "Running tests..."
	@go test -v ./...
run:
	@go run $(MAIN_PATH) $(ARGS)
help:
	@echo PrintCode2LLM Build Tool
	@echo.
	@echo Usage:
	@echo   make              - Build all platforms
	@echo   make build-local  - Build current platform
	@echo   make windows      - Build all Windows versions
	@echo   make linux        - Build all Linux versions
	@echo   make darwin       - Build all macOS versions
	@echo   make install      - Build and install to system
	@echo   make clean        - Clean build files
	@echo   make test         - Run tests
	@echo   make run ARGS=.   - Run directly
	@echo   make help         - Show this help
	@echo.
	@echo Current OS: $(DETECTED_OS)
```

### 3. README.md

```markdown
<div  align="center"> 
<img src="./ptlm.png" width="200" height="200">
<h1>PrintCode2LLM</h1>
</div>

## æ›´å¥½çš„é¢å‘AI Chatç¼–ç¨‹

æŠŠé¡¹ç›®ä»£ç æ•´ç†æˆ Markdownï¼Œæ–¹ä¾¿å–‚ç»™å¤§æ¨¡å‹ã€‚é¡¹ç›®æ²¡æœ‰ä»»ä½•ç ´è§£ï¼Œä»…æ‰“å°é¡¹ç›®ä»£ç ï¼Œå¤§é¡¹ç›®ä¸å»ºè®®ä½¿ç”¨æœ¬é¡¹ç›®æ‰“å°é¡¹ç›®ï¼ˆä¾‹å¦‚æ€»å­—ç¬¦è¶…è¿‡2 000 000å­—ç¬¦ï¼‰ã€‚

> æ³¨æ„ï¼šç›´æ¥æ‰§è¡Œ`ptlm`é»˜è®¤æ‰“å°æ‰§è¡Œç›®å½•ä¸‹çš„æ‰€æœ‰ä»£ç æ–‡ä»¶ï¼Œæ‰§è¡Œæ—¶è¯·æ³¨æ„æ‰§è¡Œæ—¶æœºã€‚

## å®‰è£…

### ä¸‹è½½é¢„ç¼–è¯‘ç‰ˆæœ¬

ä» [Releases](https://github.com/MakotoArai-CN/printcode2llm/releases) ä¸‹è½½å¯¹åº”å¹³å°çš„æ–‡ä»¶ã€‚

### ä»æºç ç¼–è¯‘

```bash
git clone https://github.com/MakotoArai-CN/printcode2llm.git
cd printcode2llm
make
```

### å®‰è£…åˆ°ç³»ç»Ÿ

```bash
./ptlm install
```

## åŸºæœ¬ç”¨æ³•

```bash
ptlm                        # æ•´ç†å½“å‰ç›®å½•
ptlm ./myproject            # æ•´ç†æŒ‡å®šç›®å½•
ptlm ./proj1 ./proj2        # æ•´ç†å¤šä¸ªé¡¹ç›®
```

ç”Ÿæˆçš„æ–‡ä»¶ï¼š`LLM_CODE_Part1_of_2.md`ã€`LLM_CODE_Part2_of_2.md` ç­‰ã€‚

## é…ç½®

é¦–æ¬¡è¿è¡Œä¼šç”Ÿæˆ `.ptlm.yaml`ï¼š

```yaml
custom_ignore:
  patterns:
    - "*.test.go"
    - "tmp/*"
  regex:
    - ".*_backup\\..*"

output:
  max_chars: 50000
  compress: true
  ultra_compress: false
  output_prefix: LLM_CODE
```

### æ‰‹åŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶

```bash
ptlm config init
```

## å¸¸ç”¨å‚æ•°

```bash
-c, --chars 30000           # æ¯æ®µæœ€å¤§å­—ç¬¦æ•°
-o, --output MY_CODE        # è¾“å‡ºæ–‡ä»¶å‰ç¼€
-u, --ultra-compress        # è¶…çº§å‹ç¼©æ¨¡å¼
-f, --config custom.yaml    # æŒ‡å®šé…ç½®æ–‡ä»¶
--exclude "*.test.go,tmp/*" # æ’é™¤æ–‡ä»¶
--regex ".*_test\\.go$"     # æ­£åˆ™æ’é™¤
--no-tree                   # ä¸ç”Ÿæˆç›®å½•æ ‘
```

## è¿‡æ»¤è§„åˆ™

### é»˜è®¤å¿½ç•¥

- ä¾èµ–ï¼š`node_modules`ã€`vendor`ã€`venv`
- ç‰ˆæœ¬æ§åˆ¶ï¼š`.git`ã€`.svn`
- æ„å»ºäº§ç‰©ï¼š`dist`ã€`build`ã€`target`
- IDEï¼š`.vscode`ã€`.idea`
- äºŒè¿›åˆ¶æ–‡ä»¶ï¼š`.exe`ã€`.so`ã€`.dll`

### è‡ªå®šä¹‰æ’é™¤

å‘½ä»¤è¡Œï¼š
```bash
ptlm --exclude "test/*,*.bak" --regex ".*_backup\\..*"
```

é…ç½®æ–‡ä»¶ï¼š
```yaml
custom_ignore:
  patterns:
    - "test/*"
    - "*.bak"
  regex:
    - ".*_backup\\..*"
```

## å‹ç¼©æ¨¡å¼

### æ ‡å‡†å‹ç¼©ï¼ˆé»˜è®¤ï¼‰

- åˆ é™¤æ³¨é‡Š
- åˆ é™¤ç©ºè¡Œ
- ä¿ç•™åŸºæœ¬æ ¼å¼

### è¶…çº§å‹ç¼©

```bash
ptlm -u
```

- æ¿€è¿›å‹ç¼©
- åˆ é™¤å‡ ä¹æ‰€æœ‰ç©ºç™½
- éœ€è¦æ ¼å¼åŒ–æ‰èƒ½é˜…è¯»

## ç‰ˆæœ¬ç®¡ç†

```bash
ptlm version                # æŸ¥çœ‹ç‰ˆæœ¬
ptlm update                 # æ£€æŸ¥æ›´æ–°
ptlm uninstall              # å¸è½½
```

## ç¼–è¯‘æ‰€æœ‰å¹³å°

```bash
make                        # ç¼–è¯‘æ‰€æœ‰å¹³å°
make windows                # åªç¼–è¯‘ Windows
make linux                  # åªç¼–è¯‘ Linux
make darwin                 # åªç¼–è¯‘ macOS
make compress               # ç”¨ upx å‹ç¼©ï¼ˆéœ€è¦å®‰è£… upxï¼‰
```

è¾“å‡ºåœ¨ `build/` ç›®å½•ã€‚

## æ”¯æŒçš„å¹³å°

- Windows: 32ä½ã€64ä½ã€ARM64
- Linux: 32ä½ã€64ä½ã€ARMã€ARM64ã€é¾™èŠ¯
- macOS: Intelã€Apple Silicon
- FreeBSD: 32ä½ã€64ä½ã€ARM

## å®é™…ä¾‹å­

### æ•´ç† Go é¡¹ç›®

```bash
ptlm --exclude "vendor/*,*_test.go" -c 40000
```

### æ•´ç†å‰ç«¯é¡¹ç›®

```bash
ptlm --exclude "node_modules,dist,*.min.js" ./src
```

### å¤šé¡¹ç›®å¯¹æ¯”

```bash
ptlm ./old-version ./new-version
```

### ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

```bash
ptlm -f project.yaml ./myproject
```

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ cmd/ptlm/           # ä¸»ç¨‹åº
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ cli/            # å‘½ä»¤è¡Œ
â”‚   â”œâ”€â”€ compress/       # ä»£ç å‹ç¼©
â”‚   â”œâ”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ generator/      # å†…å®¹ç”Ÿæˆ
â”‚   â”œâ”€â”€ output/         # æ–‡ä»¶è¾“å‡º
â”‚   â”œâ”€â”€ scanner/        # æ–‡ä»¶æ‰«æ
â”‚   â””â”€â”€ ui/             # ç•Œé¢è¾“å‡º
â”œâ”€â”€ configs/            # é…ç½®æ–‡ä»¶
â””â”€â”€ Makefile
```

## å„å®¶å¤§æ¨¡å‹å•æ¬¡æœ€å¤§è¾“å…¥é•¿åº¦

|                      ç½‘ç«™                       |     æ¨¡å‹     | ç½‘ç«™ç±»å‹ |                                æœ€å¤§è¾“å…¥é•¿åº¦                                |
| :---------------------------------------------: | :----------: | :------: | :------------------------------------------------------------------------: |
|        [lmarena.ai](https://lmarena.ai/)        |     å…¨éƒ¨     |   ä¸‰æ–¹   |                                   119993                                   |
|      [chat.qwen.ai](https://chat.qwen.ai/)      |   Qwenç³»åˆ—   |   å®˜æ–¹   |           æœªçŸ¥ï¼ˆä»£ç é‡è¾¾åˆ°ä¸€å®šé‡æ—¶ï¼Œå‘é€çš„ä»£ç ä¼šä»¥æ–‡ä»¶å½¢å¼å‘é€ï¼‰           |
|    [www.tongyi.com](https://www.tongyi.com/)    |   Qwenç³»åˆ—   |   å®˜æ–¹   |           æœªçŸ¥ï¼ˆä»£ç é‡è¾¾åˆ°ä¸€å®šé‡æ—¶ï¼Œå‘é€çš„ä»£ç ä¼šä»¥æ–‡ä»¶å½¢å¼å‘é€ï¼‰           |
|          [grok.com](https://grok.com)           |   Grokç³»åˆ—   |   å®˜æ–¹   |   æœªçŸ¥ï¼ˆè²Œä¼¼æ²¡æœ‰ä¸Šé™ï¼Œä½†æ˜¯å•æ¬¡æœ€å¥½ä¸è¦è¶…è¿‡2 000 000å­—ç¬¦ï¼Œæµè§ˆå™¨ä¼šå¡æ­»ï¼‰    |
| [chat.deepseek.com](https://chat.deepseek.com/) | Deepseekç³»åˆ— |   å®˜æ–¹   | ~300 000ï¼ˆä»£ç é‡è¾¾åˆ°ä¸€å®šé‡æ—¶ï¼Œç›´æ¥ä¸Šé™ï¼Œå¼ºåˆ¶ç»“æŸå½“å‰å¯¹è¯ï¼Œå¿…é¡»å¼€å¯æ–°å¯¹è¯ï¼‰ |
|    [www.doubao.com](https://www.doubao.com/)    |    Doubao    |   å®˜æ–¹   |                  ~10 000ï¼ˆä»£ç é‡è¾¾åˆ°ä¸€å®šé‡æ—¶ï¼Œç›´æ¥ä¸Šé™ï¼‰                   |

> ä»…åšç®€å•ä¼°ç®—ï¼Œå…·ä½“è¯·è‡ªè¡Œæµ‹è¯•ã€‚
> 
> ä»¥ä¸Šæ•°æ®éå®˜æ–¹æ•°æ®ï¼Œä»…ä¾›å‚è€ƒã€‚

## å¸¸è§é—®é¢˜

**Q: ç”Ÿæˆçš„æ–‡ä»¶å¤ªå¤§äº†ï¼Ÿ**

é™ä½å­—ç¬¦é™åˆ¶ï¼š`ptlm -c 30000`

**Q: æƒ³æ’é™¤æµ‹è¯•æ–‡ä»¶ï¼Ÿ**

```bash
ptlm --exclude "*_test.go,test/*"
```

**Q: å‹ç¼©åä»£ç çœ‹ä¸æ‡‚ï¼Ÿ**

åˆ«ç”¨è¶…çº§å‹ç¼©ï¼Œæˆ–è€…ç”¨æ ¼å¼åŒ–å·¥å…·ï¼š
```bash
# JavaScript
npx prettier --write file.js

# Python
black file.py

# Go
gofmt -w file.go
```

**Q: æƒ³è‡ªå®šä¹‰æç¤ºè¯ï¼Ÿ**

ç¼–è¾‘ `configs/prompts.yaml` æˆ– `.ptlm.yaml`ã€‚

## License

MIT

## è´¡çŒ®

æ¬¢è¿ [PR](https://github.com/MakotoArai-CN/printcode2llm/pulls)ã€‚

æŠ¥ bug æˆ–æå»ºè®®ï¼š[Issues](https://github.com/MakotoArai-CN/printcode2llm/issues)
```

### 4. cmd/ptlm/main.go

```go
package main
import (
"os"
"printcode2llm/internal/cli"
"printcode2llm/internal/ui"
)
func main() {
ui.PrintBanner()
if err := cli.Execute(); err != nil {
ui.PrintError("æ‰§è¡Œå¤±è´¥: %v", err)
os.Exit(1)
}
}
```

### 5. configs/default.yaml

```yaml
# PrintCode2LLM é»˜è®¤é…ç½®

# æ–‡ä»¶ç±»å‹æ˜ å°„
language_map:
  .js: javascript
  .jsx: javascript
  .ts: typescript
  .tsx: typescript
  .py: python
  .java: java
  .c: c
  .cpp: cpp
  .h: c
  .hpp: cpp
  .go: go
  .rs: rust
  .swift: swift
  .kt: kotlin
  .dart: dart
  .rb: ruby
  .php: php
  .html: html
  .css: css
  .scss: scss
  .less: less
  .json: json
  .xml: xml
  .yml: yaml
  .yaml: yaml
  .toml: toml
  .ini: ini
  .sh: shell
  .bash: shell
  .ps1: powershell
  .sql: sql
  .md: markdown
  .txt: text
  .vue: vue
  .svelte: svelte

# é»˜è®¤å¿½ç•¥è§„åˆ™
default_ignore:
  # ä¾èµ–ç›®å½•
  - node_modules
  - vendor
  - venv
  - .venv
  - env
  - .env
  - __pycache__
  
  # ç‰ˆæœ¬æ§åˆ¶
  - .git
  - .svn
  - .hg
  
  # IDE
  - .vscode
  - .idea
  - .vs
  - .eclipse
  
  # æ„å»ºäº§ç‰©
  - dist
  - dist-*
  - build
  - out
  - bin
  - target
  - coverage
  - .gradle
  
  # å¹³å°ç›¸å…³
  - .DS_Store
  - Thumbs.db
  - desktop.ini
  
  # èµ„æºæ–‡ä»¶
  - assets
  - static
  - public
  
  # æ–‡æ¡£
  - doc
  - docs
  
  # é…ç½®å’Œé”æ–‡ä»¶
  - package-lock.json
  - yarn.lock
  - Gemfile.lock
  - Cargo.lock
  - go.sum
  
  # æ—¥å¿—
  - "*.log"
  - logs
  
  # ä¸´æ—¶æ–‡ä»¶
  - tmp
  - temp
  - .cache
  - "*.tmp"
  - "*.bak"
  - "*.swp"
  - "*.swo"
  - "*.swn"
  - "*.old"
  
  # è¾“å‡ºæ–‡ä»¶
  - "LLM_CODE*.md"

# äºŒè¿›åˆ¶å’Œåª’ä½“æ–‡ä»¶æ‰©å±•å
binary_extensions:
  # å›¾ç‰‡
  - .jpg
  - .jpeg
  - .png
  - .gif
  - .bmp
  - .svg
  - .ico
  - .webp
  - .tiff
  - .tif
  - .psd
  - .ai
  - .eps
  - .raw
  - .cr2
  - .nef
  - .heic
  - .heif
  
  # è§†é¢‘
  - .mp4
  - .avi
  - .mov
  - .wmv
  - .flv
  - .mkv
  - .webm
  - .m4v
  - .3gp
  - .mpg
  - .mpeg
  - .vob
  - .ogv
  
  # éŸ³é¢‘
  - .mp3
  - .wav
  - .ogg
  - .flac
  - .aac
  - .m4a
  - .wma
  - .ape
  - .alac
  - .opus
  - .mid
  - .midi
  
  # æ–‡æ¡£
  - .pdf
  - .doc
  - .docx
  - .ppt
  - .pptx
  - .xls
  - .xlsx
  - .odt
  - .ods
  - .odp
  - .pages
  - .numbers
  - .key
  
  # å‹ç¼©åŒ…
  - .zip
  - .tar
  - .gz
  - .rar
  - .7z
  - .iso
  - .dmg
  - .tgz
  - .bz2
  - .xz
  - .cab
  - .deb
  - .rpm
  - .pkg
  - .msi
  
  # å¯æ‰§è¡Œæ–‡ä»¶
  - .exe
  - .dll
  - .so
  - .dylib
  - .lib
  - .a
  - .app
  - .bat
  - .cmd
  - .com
  
  # åŒ…æ–‡ä»¶
  - .jar
  - .war
  - .ear
  - .apk
  - .ipa
  - .aab
  - .aar
  - .nupkg
  - .snap
  
  # æ¨¡å‹æ–‡ä»¶
  - .pth
  - .pt
  - .onnx
  - .pb
  - .tflite
  - .h5
  - .hdf5
  - .caffemodel
  - .mlmodel
  - .savedmodel
  
  # ç¼–è¯‘äº§ç‰©
  - .pyc
  - .pyd
  - .o
  - .obj
  - .class
  - .wasm
  - .elc
  - .rbc
  
  # å­—ä½“æ–‡ä»¶
  - .ttf
  - .otf
  - .woff
  - .woff2
  - .eot
  - .fon
  - .fnt
  
  # æ•°æ®åº“æ–‡ä»¶
  - .db
  - .sqlite
  - .sqlite3
  - .mdb
  - .accdb
  - .frm
  - .ibd
  - .dbf
  
  # å…¶ä»–äºŒè¿›åˆ¶æ ¼å¼
  - .parquet
  - .feather
  - .arrow
  - .avro
  - .protobuf
  - .msgpack
  - .pickle
  - .pkl
  - .npy
  - .npz
  - .mat
  - .rds
  - .rda
  - .RData

# éä»£ç æ–‡ä»¶æ‰©å±•åï¼ˆæ–‡æœ¬æ–‡ä»¶ä½†ä¸æ˜¯ä»£ç ï¼‰
non_code_extensions:
  - .md
  - .txt
  - .log
  - .csv
  - .json
  - .xml
  - .yml
  - .yaml
  - .toml
  - .ini
  - .conf
  - .config

# é»˜è®¤è®¾ç½®
defaults:
  max_chars: 50000
  compress: true
  ultra_compress: false
  split_mode: file
  include_tree: true
  output_prefix: LLM_CODE
```

### 6. configs/prompts.yaml

```yaml
# æç¤ºè¯é…ç½®æ–‡ä»¶

# é¡¹ç›®ä¿¡æ¯åŒºåŸŸçš„æ ‡é¢˜
section_info: "é¡¹ç›®æ¦‚å†µ"

# ç›®å½•ç»“æ„åŒºåŸŸçš„æ ‡é¢˜
section_tree: "ç›®å½•ç»“æ„"

# ä»£ç æ–‡ä»¶åŒºåŸŸçš„æ ‡é¢˜
section_code: "æºç æ¸…å•"

# ç»Ÿè®¡ä¿¡æ¯åŒºåŸŸçš„æ ‡é¢˜
section_stats: "æ•°æ®ç»Ÿè®¡"

# é¡µçœ‰æç¤ºï¼ˆæ”¾åœ¨æ¯ä¸ªæ–‡ä»¶å¼€å¤´ï¼‰
header_prompt: |
  ## é˜…è¯»é¡»çŸ¥
  
  è¿™æ˜¯ä¸€ä¸ªé¡¹ç›®æºç æ•´ç†æ–‡æ¡£ï¼ŒåŒ…å«å®Œæ•´çš„ä»£ç æ–‡ä»¶ã€‚
  
  **å¤„ç†å»ºè®®ï¼š**
  - å¦‚éœ€ä¿®æ”¹ä»£ç ï¼Œè¯·ä¿æŒåŸæœ‰ç»“æ„å’Œæ³¨é‡Š
  - é™¤éæ˜ç¡®è¦æ±‚ï¼Œå¦åˆ™åªåšå¿…è¦çš„æ”¹åŠ¨
  - è¿”å›ä»£ç æ—¶ä½¿ç”¨å®Œæ•´å®ç°ï¼Œé¿å…çœç•¥
  - ä¿æŒåŸé¡¹ç›®çš„åŠŸèƒ½å’Œç•Œé¢ä¸å˜
  
  **ä»£ç è§„èŒƒï¼š**
  - ç¦æ­¢ä½¿ç”¨ "// ... ä¿æŒä¸å˜" ç­‰çœç•¥å†™æ³•
  - ç¦æ­¢ä½¿ç”¨ "// ... å…¶ä»–ä»£ç " ç­‰ç®€åŒ–è¡¨è¾¾
  - ç®—æ³•å®ç°å¿…é¡»å®Œæ•´ï¼Œä¸å¾—ç¼©å‡
  - å¦‚æœä»£ç è¿‡é•¿ï¼Œåˆ†æ‰¹æ¬¡å®Œæ•´è¿”å›

# å‹ç¼©æç¤º
compress_notice: |
  æ³¨æ„ï¼šä»£ç å·²ç»è¿‡å‹ç¼©å¤„ç†ï¼Œå»ºè®®ä½¿ç”¨å‰å…ˆæ ¼å¼åŒ–ã€‚

# è¶…çº§å‹ç¼©æç¤º
ultra_compress_notice: |
  æ³¨æ„ï¼šä»£ç å·²ç»è¿‡æ·±åº¦å‹ç¼©ï¼Œä½¿ç”¨å‰å¿…é¡»æ ¼å¼åŒ–ï¼Œå¦åˆ™å¯è¯»æ€§è¾ƒå·®ã€‚

# åˆ†æ®µæç¤ºï¼ˆå½“æ–‡ä»¶è¢«åˆ†æˆå¤šä¸ªéƒ¨åˆ†æ—¶ï¼‰
continue_notice: |
  å½“å‰å†…å®¹æœªå®Œï¼Œè¯·ç­‰å¾…åç»­éƒ¨åˆ†ã€‚

# å®Œæˆæç¤º
complete_notice: |
  å…¨éƒ¨å†…å®¹å·²å±•ç¤ºå®Œæ¯•ã€‚

# å¤šé¡¹ç›®åˆ†éš”æç¤º
project_separator: |
  
  ---
  
  ä»¥ä¸Šæ˜¯é¡¹ç›® **%s** çš„å®Œæ•´å†…å®¹ã€‚
  
  ---

# æ–‡ä»¶ä¿¡æ¯æ ¼å¼
file_info_format: "**ç±»å‹**: %s | **è¡Œæ•°**: %d | **å¤§å°**: %s"

# éä»£ç æ–‡ä»¶æç¤º
non_code_file_notice: "æ­¤æ–‡ä»¶ä¸ºé…ç½®/æ–‡æ¡£ç±»å‹ï¼Œéå¯æ‰§è¡Œä»£ç "

# äºŒè¿›åˆ¶æ–‡ä»¶è·³è¿‡æç¤º
binary_file_skip: "è·³è¿‡äºŒè¿›åˆ¶æ–‡ä»¶"

# ç»Ÿè®¡è¡¨æ ¼æ ‡é¢˜
stats_table_header: |
  | æŒ‡æ ‡ | æ•°å€¼ |
  |------|------|

# åˆ†æ®µå‘é€ä½¿ç”¨è¯´æ˜
usage_instructions: |
  ## ä½¿ç”¨è¯´æ˜
  
  1. æœ¬æ–‡æ¡£å…±åˆ†ä¸º %d ä¸ªéƒ¨åˆ†
  2. è¯·æŒ‰é¡ºåºå‘é€ç»™ AI åŠ©æ‰‹
  3. æ¯ä¸ªéƒ¨åˆ†å¯ç‹¬ç«‹é˜…è¯»ï¼Œå†…å®¹è¿ç»­
  4. å»ºè®®å¼€å§‹æ—¶è¯´æ˜è¿™æ˜¯åˆ†æ®µå‘é€çš„é¡¹ç›®ä»£ç 
```

### 7. go.mod

```text
module printcode2llm
go 1.21
require (
	github.com/fatih/color v1.16.0
	github.com/spf13/cobra v1.8.0
	gopkg.in/yaml.v3 v3.0.1
)
require (
	github.com/inconshreveable/mousetrap v1.1.0 // indirect
	github.com/mattn/go-colorable v0.1.13 // indirect
	github.com/mattn/go-isatty v0.0.20 // indirect
	github.com/spf13/pflag v1.0.5 // indirect
	golang.org/x/sys v0.14.0 // indirect
)
```

### 8. internal/cli/config.go

```go
package cli
import (
"fmt"
"os"
"printcode2llm/internal/config"
"printcode2llm/internal/ui"
"github.com/spf13/cobra"
)
var configCmd = &cobra.Command{
Use: "config",
Short: "é…ç½®æ–‡ä»¶ç®¡ç†",
}
var configInitCmd = &cobra.Command{
Use: "init",
Short: "ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶",
RunE: runConfigInit,
}
func init() {
rootCmd.AddCommand(configCmd)
configCmd.AddCommand(configInitCmd)
}
func runConfigInit(cmd *cobra.Command, args []string) error {
configPath := ".ptlm.yaml"
if _, err := os.Stat(configPath); err == nil {
ui.PrintWarning("é…ç½®æ–‡ä»¶å·²å­˜åœ¨: %s", configPath)
fmt.Print("æ˜¯å¦è¦†ç›–ï¼Ÿ(y/N): ")
var answer string
fmt.Scanln(&answer)
if answer != "y" && answer != "Y" {
ui.PrintInfo("å·²å–æ¶ˆ")
return nil
}
}
cfg := config.Default()
if err := config.Save(cfg, configPath); err != nil {
return fmt.Errorf("ä¿å­˜é…ç½®æ–‡ä»¶å¤±è´¥: %w", err)
}
ui.PrintSuccess("é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: %s", configPath)
ui.PrintInfo("å¯ä»¥ç¼–è¾‘æ­¤æ–‡ä»¶æ¥è‡ªå®šä¹‰é…ç½®")
return nil
}
```

### 9. internal/cli/install.go

```go
package cli
import (
"fmt"
"os"
"path/filepath"
"runtime"
"printcode2llm/internal/ui"
"github.com/spf13/cobra"
)
var installCmd = &cobra.Command{
Use: "install",
Short: "å®‰è£… ptlm åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡",
Long: "å°† ptlm å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»Ÿè·¯å¾„ï¼Œå¹¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡",
RunE: runInstall,
}
func init() {
rootCmd.AddCommand(installCmd)
}
func runInstall(cmd *cobra.Command, args []string) error {
ui.PrintHeader("å®‰è£… ptlm")
exePath, err := os.Executable()
if err != nil {
return fmt.Errorf("è·å–å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å¤±è´¥: %w", err)
}
exePath, err = filepath.EvalSymlinks(exePath)
if err != nil {
return fmt.Errorf("è§£æç¬¦å·é“¾æ¥å¤±è´¥: %w", err)
}
ui.PrintInfo("å½“å‰è·¯å¾„: %s", exePath)
var targetDir string
var targetPath string
switch runtime.GOOS {
case "windows":
targetDir = filepath.Join(os.Getenv("USERPROFILE"), "bin")
targetPath = filepath.Join(targetDir, "ptlm.exe")
if err := os.MkdirAll(targetDir, 0755); err != nil {
return fmt.Errorf("åˆ›å»ºç›®å½•å¤±è´¥: %w", err)
}
input, err := os.ReadFile(exePath)
if err != nil {
return fmt.Errorf("è¯»å–æºæ–‡ä»¶å¤±è´¥: %w", err)
}
if err := os.WriteFile(targetPath, input, 0755); err != nil {
return fmt.Errorf("å¤åˆ¶æ–‡ä»¶å¤±è´¥: %w", err)
}
ui.PrintSuccess("æ–‡ä»¶å·²å¤åˆ¶åˆ°: %s", targetPath)
if err := addToSystemPath(targetDir); err != nil {
ui.PrintWarning("è‡ªåŠ¨æ·»åŠ ç¯å¢ƒå˜é‡å¤±è´¥: %v", err)
ui.PrintInfo("è¯·æ‰‹åŠ¨æ·»åŠ  %s åˆ°ç³»ç»Ÿ PATH", targetDir)
} else {
ui.PrintSuccess("å·²æ·»åŠ åˆ°ç”¨æˆ·ç¯å¢ƒå˜é‡ PATH")
ui.PrintInfo("è¯·é‡æ–°æ‰“å¼€å‘½ä»¤è¡Œçª—å£ç”Ÿæ•ˆ")
}
case "darwin", "linux":
if os.Geteuid() == 0 {
targetDir = "/usr/local/bin"
} else {
homeDir, _ := os.UserHomeDir()
targetDir = filepath.Join(homeDir, "bin")
}
targetPath = filepath.Join(targetDir, "ptlm")
if err := os.MkdirAll(targetDir, 0755); err != nil {
return fmt.Errorf("åˆ›å»ºç›®å½•å¤±è´¥: %w", err)
}
input, err := os.ReadFile(exePath)
if err != nil {
return fmt.Errorf("è¯»å–æºæ–‡ä»¶å¤±è´¥: %w", err)
}
if err := os.WriteFile(targetPath, input, 0755); err != nil {
return fmt.Errorf("å†™å…¥æ–‡ä»¶å¤±è´¥: %w", err)
}
ui.PrintSuccess("æ–‡ä»¶å·²å¤åˆ¶åˆ°: %s", targetPath)
if targetDir != "/usr/local/bin" {
if err := addToSystemPath(targetDir); err != nil {
ui.PrintWarning("è‡ªåŠ¨æ·»åŠ  PATH å¤±è´¥: %v", err)
ui.PrintInfo("è¯·æ‰‹åŠ¨æ·»åŠ ä»¥ä¸‹è¡Œåˆ° ~/.bashrc æˆ– ~/.zshrc:")
ui.PrintInfo(`export PATH="$HOME/bin:$PATH"`)
} else {
ui.PrintSuccess("å·²æ·»åŠ åˆ° PATH")
ui.PrintInfo("è¯·è¿è¡Œ: source ~/.bashrc æˆ–é‡æ–°æ‰“å¼€ç»ˆç«¯")
}
}
default:
return fmt.Errorf("ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: %s", runtime.GOOS)
}
fmt.Println()
ui.PrintSuccess("å®‰è£…å®Œæˆï¼")
ui.PrintInfo("è¿è¡Œ 'ptlm --help' æŸ¥çœ‹ä½¿ç”¨è¯´æ˜")
return nil
}
```

### 10. internal/cli/linux_helper.go

```go
package cli
import (
"fmt"
"os"
"path/filepath"
"strings"
"printcode2llm/internal/ui"
)
func addToSystemPath(dir string) error {
homeDir, err := os.UserHomeDir()
if err != nil {
return err
}
shells := []string{".bashrc", ".zshrc", ".profile"}
exportLine := `export PATH="$HOME/bin:$PATH"`
for _, shell := range shells {
shellPath := filepath.Join(homeDir, shell)
if _, err := os.Stat(shellPath); os.IsNotExist(err) {
continue
}
content, err := os.ReadFile(shellPath)
if err != nil {
continue
}
if strings.Contains(string(content), exportLine) {
ui.PrintInfo("PATH å·²åœ¨ %s ä¸­é…ç½®", shell)
return nil
}
f, err := os.OpenFile(shellPath, os.O_APPEND|os.O_WRONLY, 0644)
if err != nil {
continue
}
defer f.Close()
_, err = f.WriteString("\n# Added by ptlm\n" + exportLine + "\n")
if err != nil {
continue
}
ui.PrintSuccess("å·²æ·»åŠ åˆ° %s", shell)
return nil
}
return fmt.Errorf("æœªæ‰¾åˆ° shell é…ç½®æ–‡ä»¶")
}
func removeFromSystemPath(dir string) error {
homeDir, err := os.UserHomeDir()
if err != nil {
return err
}
shells := []string{".bashrc", ".zshrc", ".profile"}
removed := false
for _, shell := range shells {
shellPath := filepath.Join(homeDir, shell)
if _, err := os.Stat(shellPath); os.IsNotExist(err) {
continue
}
content, err := os.ReadFile(shellPath)
if err != nil {
continue
}
lines := strings.Split(string(content), "\n")
newLines := make([]string, 0)
skip := false
for _, line := range lines {
trimmed := strings.TrimSpace(line)
if trimmed == "# Added by ptlm" {
skip = true
continue
}
if skip && strings.Contains(line, "export PATH") && strings.Contains(line, "$HOME/bin") {
skip = false
removed = true
continue
}
if strings.Contains(line, "export PATH") &&
(strings.Contains(line, filepath.Join(homeDir, "bin")) || strings.Contains(line, "$HOME/bin")) &&
(strings.Contains(line, "ptlm") || strings.Contains(line, "Added by ptlm")) {
removed = true
continue
}
newLines = append(newLines, line)
skip = false
}
if removed {
newContent := strings.Join(newLines, "\n")
if err := os.WriteFile(shellPath, []byte(newContent), 0644); err != nil {
return err
}
ui.PrintSuccess("å·²ä» %s ä¸­ç§»é™¤é…ç½®", shell)
}
}
if !removed {
return fmt.Errorf("æœªæ‰¾åˆ° PATH é…ç½®")
}
return nil
}
```

### 11. internal/cli/root.go

```go
package cli
import (
"fmt"
"os"
"strings"
"printcode2llm/internal/config"
"printcode2llm/internal/generator"
"printcode2llm/internal/output"
"printcode2llm/internal/scanner"
"printcode2llm/internal/ui"
"github.com/spf13/cobra"
)
var (
cfg *config.Config
projectDirs []string
outputPrefix string
maxChars int
compress bool
ultraCompress bool
splitMode string
includeTree bool
excludePatterns string
regexPatterns string
configPath string
)
var rootCmd = &cobra.Command{
Use: "ptlm [é¡¹ç›®ç›®å½•...]",
Short: "å°†é¡¹ç›®ä»£ç æ•´ç†æˆé€‚åˆå¤§æ¨¡å‹é˜…è¯»çš„æ ¼å¼",
Long: `PrintCode2LLM (ptlm) - ä»£ç æ•´ç†å·¥å…·

å°†é¡¹ç›®ä»£ç æ‰“åŒ…æˆ Markdown æ ¼å¼ï¼Œæ–¹ä¾¿å‘é€ç»™å¤§æ¨¡å‹è¿›è¡Œåˆ†æã€‚

ç‰¹æ€§ï¼š
  â€¢ æ™ºèƒ½ä»£ç å‹ç¼©
  â€¢ å¤šé¡¹ç›®æ”¯æŒ
  â€¢ çµæ´»çš„è¿‡æ»¤è§„åˆ™
  â€¢ è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯`,
RunE: runMain,
}
func init() {
rootCmd.Flags().StringSliceVarP(&projectDirs, "dir", "d", []string{"."}, "é¡¹ç›®ç›®å½•ï¼ˆå¯å¤šä¸ªï¼‰")
rootCmd.Flags().StringVarP(&outputPrefix, "output", "o", "", "è¾“å‡ºæ–‡ä»¶å‰ç¼€")
rootCmd.Flags().IntVarP(&maxChars, "chars", "c", 0, "æ¯æ®µæœ€å¤§å­—ç¬¦æ•°")
rootCmd.Flags().BoolVar(&compress, "compress", true, "å‹ç¼©ä»£ç ")
rootCmd.Flags().BoolVarP(&ultraCompress, "ultra-compress", "u", false, "è¶…çº§å‹ç¼©æ¨¡å¼")
rootCmd.Flags().StringVarP(&splitMode, "split-mode", "s", "", "åˆ†å‰²æ¨¡å¼: file/line")
rootCmd.Flags().BoolVar(&includeTree, "tree", true, "åŒ…å«ç›®å½•æ ‘")
rootCmd.Flags().StringVar(&excludePatterns, "exclude", "", "æ’é™¤æ¨¡å¼ï¼ˆé€—å·åˆ†éš”ï¼‰")
rootCmd.Flags().StringVar(&regexPatterns, "regex", "", "æ­£åˆ™æ’é™¤æ¨¡å¼ï¼ˆé€—å·åˆ†éš”ï¼‰")
rootCmd.Flags().StringSliceVar(&projectDirs, "multi", []string{}, "å¤šé¡¹ç›®æ¨¡å¼")
rootCmd.Flags().StringVarP(&configPath, "config", "f", "", "æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„")
}
func Execute() error {
return rootCmd.Execute()
}
func runMain(cmd *cobra.Command, args []string) error {
var err error
if configPath != "" {
config.SetConfigPath(configPath)
}
cfg, err = config.Load()
if err != nil {
ui.PrintWarning("é…ç½®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®: %v", err)
cfg = config.Default()
}
if len(args) > 0 {
projectDirs = args
}
if outputPrefix != "" {
cfg.Output.OutputPrefix = outputPrefix
}
if maxChars > 0 {
cfg.Output.MaxChars = maxChars
}
if cmd.Flags().Changed("compress") {
cfg.Output.Compress = compress
}
if ultraCompress {
cfg.Output.UltraCompress = true
cfg.Output.Compress = true
}
if splitMode != "" {
cfg.Output.SplitMode = splitMode
}
if cmd.Flags().Changed("tree") {
cfg.Output.IncludeTree = includeTree
}
if excludePatterns != "" {
patterns := strings.Split(excludePatterns, ",")
cfg.CustomIgnore.Patterns = append(cfg.CustomIgnore.Patterns, patterns...)
}
if regexPatterns != "" {
patterns := strings.Split(regexPatterns, ",")
cfg.CustomIgnore.Regex = append(cfg.CustomIgnore.Regex, patterns...)
}
if len(projectDirs) == 0 {
projectDirs = []string{"."}
}
ui.PrintHeader("é¡¹ç›®ä»£ç æ•´ç†å·¥å…·")
ui.PrintInfo("é¡¹ç›®æ•°é‡: %d", len(projectDirs))
ui.PrintInfo("å­—ç¬¦é™åˆ¶: %s", ui.FormatNumber(cfg.Output.MaxChars))
ui.PrintInfo("å‹ç¼©æ¨¡å¼: %s", getCompressMode(cfg))
ui.PrintInfo("åˆ†å‰²æ¨¡å¼: %s", cfg.Output.SplitMode)
fmt.Println()
if err := output.CleanOldFiles(cfg.Output.OutputPrefix); err != nil {
ui.PrintWarning("æ¸…ç†æ—§æ–‡ä»¶å¤±è´¥: %v", err)
}
allResults := make([]*generator.Result, 0)
for _, projectDir := range projectDirs {
ui.PrintSection("å¤„ç†é¡¹ç›®: %s", projectDir)
if _, err := os.Stat(projectDir); os.IsNotExist(err) {
ui.PrintError("ç›®å½•ä¸å­˜åœ¨: %s", projectDir)
continue
}
ui.PrintStep("æ‰«ææ–‡ä»¶...")
files, err := scanner.ScanDirectory(projectDir, cfg)
if err != nil {
ui.PrintError("æ‰«æå¤±è´¥: %v", err)
continue
}
ui.PrintSuccess("æ‰¾åˆ° %d ä¸ªæ–‡ä»¶", len(files))
ui.PrintStep("ç”Ÿæˆå†…å®¹...")
result, err := generator.Generate(projectDir, files, cfg)
if err != nil {
ui.PrintError("ç”Ÿæˆå¤±è´¥: %v", err)
continue
}
allResults = append(allResults, result)
ui.PrintSuccess("ç”Ÿæˆ %d ä¸ªåˆ†æ®µ", len(result.Segments))
fmt.Println()
}
if len(allResults) == 0 {
ui.PrintWarning("æ²¡æœ‰æˆåŠŸå¤„ç†ä»»ä½•é¡¹ç›®")
return nil
}
ui.PrintSection("å†™å…¥æ–‡ä»¶")
totalSize, err := output.WriteResults(allResults, cfg)
if err != nil {
return fmt.Errorf("å†™å…¥æ–‡ä»¶å¤±è´¥: %w", err)
}
fmt.Println()
ui.PrintSuccess("å…¨éƒ¨å®Œæˆï¼")
ui.PrintInfo("æ€»è¾“å‡ºå¤§å°: %s", ui.FormatBytes(totalSize))
totalSegments := 0
for _, r := range allResults {
totalSegments += len(r.Segments)
}
if totalSegments > 1 {
fmt.Println()
ui.PrintSection("ä½¿ç”¨è¯´æ˜")
ui.PrintInfo("å…±ç”Ÿæˆ %d ä¸ªæ–‡ä»¶", totalSegments)
ui.PrintInfo("è¯·æŒ‰é¡ºåºå‘é€ç»™å¤§æ¨¡å‹")
ui.PrintInfo("å»ºè®®åœ¨å¯¹è¯å¼€å§‹æ—¶è¯´æ˜è¿™æ˜¯åˆ†æ®µå‘é€çš„ä»£ç ")
}
return nil
}
func getCompressMode(cfg *config.Config) string {
if !cfg.Output.Compress {
return "ä¸å‹ç¼©"
}
if cfg.Output.UltraCompress {
return "è¶…çº§å‹ç¼©"
}
return "æ ‡å‡†å‹ç¼©"
}
```

### 12. internal/cli/uninstall.go

```go
package cli
import (
"fmt"
"os"
"path/filepath"
"runtime"
"printcode2llm/internal/ui"
"github.com/spf13/cobra"
)
var uninstallCmd = &cobra.Command{
Use: "uninstall",
Short: "å¸è½½ ptlm",
Long: "ä»ç³»ç»Ÿä¸­ç§»é™¤ ptlm å¯æ‰§è¡Œæ–‡ä»¶å¹¶æ¸…ç†ç¯å¢ƒå˜é‡",
RunE: runUninstall,
}
func init() {
rootCmd.AddCommand(uninstallCmd)
}
func runUninstall(cmd *cobra.Command, args []string) error {
ui.PrintHeader("å¸è½½ ptlm")
var targetPaths []string
var targetDir string
switch runtime.GOOS {
case "windows":
userProfile := os.Getenv("USERPROFILE")
targetDir = filepath.Join(userProfile, "bin")
targetPaths = []string{
filepath.Join(targetDir, "ptlm.exe"),
}
case "darwin", "linux":
homeDir, _ := os.UserHomeDir()
targetPaths = []string{
"/usr/local/bin/ptlm",
filepath.Join(homeDir, "bin", "ptlm"),
}
default:
return fmt.Errorf("ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: %s", runtime.GOOS)
}
removed := false
for _, path := range targetPaths {
if _, err := os.Stat(path); err == nil {
if err := os.Remove(path); err != nil {
ui.PrintWarning("åˆ é™¤å¤±è´¥: %s (%v)", path, err)
} else {
ui.PrintSuccess("å·²åˆ é™¤: %s", path)
removed = true
if runtime.GOOS == "windows" {
targetDir = filepath.Dir(path)
}
}
}
}
if !removed {
ui.PrintWarning("æœªæ‰¾åˆ°å·²å®‰è£…çš„ ptlm")
return nil
}
switch runtime.GOOS {
case "windows":
if err := removeFromSystemPath(targetDir); err != nil {
ui.PrintWarning("æ¸…ç†ç¯å¢ƒå˜é‡å¤±è´¥: %v", err)
ui.PrintInfo("è¯·æ‰‹åŠ¨ä»ç¯å¢ƒå˜é‡ PATH ä¸­ç§»é™¤: %s", targetDir)
} else {
ui.PrintSuccess("å·²ä»ç¯å¢ƒå˜é‡ PATH ä¸­ç§»é™¤")
ui.PrintInfo("è¯·é‡æ–°æ‰“å¼€å‘½ä»¤è¡Œçª—å£ç”Ÿæ•ˆ")
}
case "darwin", "linux":
homeDir, _ := os.UserHomeDir()
binDir := filepath.Join(homeDir, "bin")
if err := removeFromSystemPath(binDir); err != nil {
ui.PrintWarning("æ¸…ç† PATH é…ç½®å¤±è´¥: %v", err)
ui.PrintInfo("è¯·æ‰‹åŠ¨ä» ~/.bashrc æˆ– ~/.zshrc ä¸­åˆ é™¤ç›¸å…³é…ç½®")
} else {
ui.PrintSuccess("å·²æ¸…ç† PATH é…ç½®")
ui.PrintInfo("è¯·è¿è¡Œ: source ~/.bashrc æˆ–é‡æ–°æ‰“å¼€ç»ˆç«¯")
}
}
fmt.Println()
ui.PrintSuccess("å¸è½½å®Œæˆï¼")
return nil
}
```

### 13. internal/cli/update.go

```go
package cli
import (
"encoding/json"
"fmt"
"io"
"net/http"
"os"
"path/filepath"
"runtime"
"strings"
"time"
"printcode2llm/internal/ui"
"printcode2llm/internal/version"
"github.com/spf13/cobra"
)
var updateCmd = &cobra.Command{
Use: "update",
Short: "æ£€æŸ¥å¹¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬",
RunE: runUpdate,
}
func init() {
rootCmd.AddCommand(updateCmd)
}
type GithubRelease struct {
TagName string `json:"tag_name"`
Assets []struct {
Name string `json:"name"`
BrowserDownloadURL string `json:"browser_download_url"`
} `json:"assets"`
}
func runUpdate(cmd *cobra.Command, args []string) error {
ui.PrintHeader("æ£€æŸ¥æ›´æ–°")
ui.PrintInfo("å½“å‰ç‰ˆæœ¬: %s", version.Version)
ui.PrintStep("æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬...")
apiURL := strings.Replace(version.Repo, "github.com", "api.github.com/repos", 1) + "/releases/latest"
client := &http.Client{Timeout: 10 * time.Second}
resp, err := client.Get(apiURL)
if err != nil {
return fmt.Errorf("ç½‘ç»œè¯·æ±‚å¤±è´¥: %w", err)
}
defer resp.Body.Close()
if resp.StatusCode != 200 {
return fmt.Errorf("è·å–ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥: HTTP %d", resp.StatusCode)
}
var release GithubRelease
if err := json.NewDecoder(resp.Body).Decode(&release); err != nil {
return fmt.Errorf("è§£æç‰ˆæœ¬ä¿¡æ¯å¤±è´¥: %w", err)
}
latestVersion := strings.TrimPrefix(release.TagName, "v")
ui.PrintInfo("æœ€æ–°ç‰ˆæœ¬: %s", latestVersion)
if latestVersion == version.Version {
fmt.Println()
ui.PrintSuccess("å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬")
return nil
}
fmt.Println()
ui.PrintInfo("å‘ç°æ–°ç‰ˆæœ¬ï¼Œå¼€å§‹ä¸‹è½½...")
assetName := getAssetName()
var downloadURL string
for _, asset := range release.Assets {
if asset.Name == assetName {
downloadURL = asset.BrowserDownloadURL
break
}
}
if downloadURL == "" {
return fmt.Errorf("æœªæ‰¾åˆ°é€‚åˆå½“å‰ç³»ç»Ÿçš„å®‰è£…åŒ…: %s", assetName)
}
tmpFile := filepath.Join(os.TempDir(), assetName)
if err := downloadFile(downloadURL, tmpFile); err != nil {
return fmt.Errorf("ä¸‹è½½å¤±è´¥: %w", err)
}
exePath, err := os.Executable()
if err != nil {
return fmt.Errorf("è·å–å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å¤±è´¥: %w", err)
}
exePath, err = filepath.EvalSymlinks(exePath)
if err != nil {
return fmt.Errorf("è§£æè·¯å¾„å¤±è´¥: %w", err)
}
backupPath := exePath + ".old"
if err := os.Rename(exePath, backupPath); err != nil {
return fmt.Errorf("å¤‡ä»½å½“å‰ç‰ˆæœ¬å¤±è´¥: %w", err)
}
input, err := os.ReadFile(tmpFile)
if err != nil {
os.Rename(backupPath, exePath)
return fmt.Errorf("è¯»å–ä¸‹è½½æ–‡ä»¶å¤±è´¥: %w", err)
}
if err := os.WriteFile(exePath, input, 0755); err != nil {
os.Rename(backupPath, exePath)
return fmt.Errorf("æ›¿æ¢æ–‡ä»¶å¤±è´¥: %w", err)
}
os.Remove(tmpFile)
os.Remove(backupPath)
fmt.Println()
ui.PrintSuccess("æ›´æ–°å®Œæˆï¼")
ui.PrintInfo("æ–°ç‰ˆæœ¬: %s", latestVersion)
ui.PrintInfo("é‡æ–°è¿è¡Œ ptlm ä»¥ä½¿ç”¨æ–°ç‰ˆæœ¬")
return nil
}
func getAssetName() string {
switch runtime.GOOS {
case "windows":
return "ptlm.exe"
case "darwin":
return "ptlm-darwin"
case "linux":
return "ptlm-linux"
default:
return "ptlm"
}
}
func downloadFile(url, filepath string) error {
client := &http.Client{Timeout: 60 * time.Second}
resp, err := client.Get(url)
if err != nil {
return err
}
defer resp.Body.Close()
out, err := os.Create(filepath)
if err != nil {
return err
}
defer out.Close()
_, err = io.Copy(out, resp.Body)
return err
}
```

### 14. internal/cli/version.go

```go
package cli
import (
"fmt"
"printcode2llm/internal/ui"
"printcode2llm/internal/version"
"github.com/spf13/cobra"
)
var versionCmd = &cobra.Command{
Use: "version",
Aliases: []string{"v"},
Short: "æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯",
Run: runVersion,
}
func init() {
rootCmd.AddCommand(versionCmd)
}
func runVersion(cmd *cobra.Command, args []string) {
ui.PrintHeader("ç‰ˆæœ¬ä¿¡æ¯")
ui.PrintInfo("ç‰ˆæœ¬: %s", version.Version)
ui.PrintInfo("ä»“åº“: %s", version.Repo)
fmt.Println()
}
```

### 15. internal/cli/windows_helper.go

```go
package cli
import (
"fmt"
"strings"
"syscall"
"unsafe"
)
func addToSystemPath(dir string) error {
advapi32 := syscall.NewLazyDLL("advapi32.dll")
user32 := syscall.NewLazyDLL("user32.dll")
regOpenKeyEx := advapi32.NewProc("RegOpenKeyExW")
regQueryValueEx := advapi32.NewProc("RegQueryValueExW")
regSetValueEx := advapi32.NewProc("RegSetValueExW")
regCloseKey := advapi32.NewProc("RegCloseKey")
sendMessageTimeout := user32.NewProc("SendMessageTimeoutW")
const (
HKEY_CURRENT_USER = 0x80000001
KEY_READ = 0x20019
KEY_WRITE = 0x20006
REG_SZ = 1
HWND_BROADCAST = 0xFFFF
WM_SETTINGCHANGE = 0x001A
SMTO_ABORTIFHUNG = 0x0002
)
keyPath, _ := syscall.UTF16PtrFromString(`Environment`)
valueName, _ := syscall.UTF16PtrFromString(`Path`)
var hKey syscall.Handle
ret, _, _ := regOpenKeyEx.Call(
uintptr(HKEY_CURRENT_USER),
uintptr(unsafe.Pointer(keyPath)),
0,
KEY_READ|KEY_WRITE,
uintptr(unsafe.Pointer(&hKey)),
)
if ret != 0 {
return fmt.Errorf("æ‰“å¼€æ³¨å†Œè¡¨å¤±è´¥: %d", ret)
}
defer regCloseKey.Call(uintptr(hKey))
var bufSize uint32 = 4096
buf := make([]uint16, bufSize)
ret, _, _ = regQueryValueEx.Call(
uintptr(hKey),
uintptr(unsafe.Pointer(valueName)),
0,
0,
uintptr(unsafe.Pointer(&buf[0])),
uintptr(unsafe.Pointer(&bufSize)),
)
if ret != 0 && ret != 234 {
return fmt.Errorf("è¯»å– PATH å¤±è´¥: %d", ret)
}
currentPath := syscall.UTF16ToString(buf)
paths := strings.Split(currentPath, ";")
for _, p := range paths {
if strings.EqualFold(strings.TrimSpace(p), dir) {
return nil
}
}
newPath := currentPath
if !strings.HasSuffix(currentPath, ";") && currentPath != "" {
newPath += ";"
}
newPath += dir
newPathUTF16, _ := syscall.UTF16FromString(newPath)
ret, _, _ = regSetValueEx.Call(
uintptr(hKey),
uintptr(unsafe.Pointer(valueName)),
0,
REG_SZ,
uintptr(unsafe.Pointer(&newPathUTF16[0])),
uintptr(len(newPathUTF16)*2),
)
if ret != 0 {
return fmt.Errorf("å†™å…¥ PATH å¤±è´¥: %d", ret)
}
envPtr, _ := syscall.UTF16PtrFromString("Environment")
sendMessageTimeout.Call(
HWND_BROADCAST,
WM_SETTINGCHANGE,
0,
uintptr(unsafe.Pointer(envPtr)),
SMTO_ABORTIFHUNG,
5000,
0,
)
return nil
}
func removeFromSystemPath(dir string) error {
advapi32 := syscall.NewLazyDLL("advapi32.dll")
user32 := syscall.NewLazyDLL("user32.dll")
regOpenKeyEx := advapi32.NewProc("RegOpenKeyExW")
regQueryValueEx := advapi32.NewProc("RegQueryValueExW")
regSetValueEx := advapi32.NewProc("RegSetValueExW")
regCloseKey := advapi32.NewProc("RegCloseKey")
sendMessageTimeout := user32.NewProc("SendMessageTimeoutW")
const (
HKEY_CURRENT_USER = 0x80000001
KEY_READ = 0x20019
KEY_WRITE = 0x20006
REG_SZ = 1
HWND_BROADCAST = 0xFFFF
WM_SETTINGCHANGE = 0x001A
SMTO_ABORTIFHUNG = 0x0002
)
keyPath, _ := syscall.UTF16PtrFromString(`Environment`)
valueName, _ := syscall.UTF16PtrFromString(`Path`)
var hKey syscall.Handle
ret, _, _ := regOpenKeyEx.Call(
uintptr(HKEY_CURRENT_USER),
uintptr(unsafe.Pointer(keyPath)),
0,
KEY_READ|KEY_WRITE,
uintptr(unsafe.Pointer(&hKey)),
)
if ret != 0 {
return fmt.Errorf("æ‰“å¼€æ³¨å†Œè¡¨å¤±è´¥: %d", ret)
}
defer regCloseKey.Call(uintptr(hKey))
var bufSize uint32 = 4096
buf := make([]uint16, bufSize)
ret, _, _ = regQueryValueEx.Call(
uintptr(hKey),
uintptr(unsafe.Pointer(valueName)),
0,
0,
uintptr(unsafe.Pointer(&buf[0])),
uintptr(unsafe.Pointer(&bufSize)),
)
if ret != 0 && ret != 234 {
return fmt.Errorf("è¯»å– PATH å¤±è´¥: %d", ret)
}
currentPath := syscall.UTF16ToString(buf)
paths := strings.Split(currentPath, ";")
found := false
newPaths := make([]string, 0)
for _, p := range paths {
trimmed := strings.TrimSpace(p)
if trimmed != "" && !strings.EqualFold(trimmed, dir) {
newPaths = append(newPaths, trimmed)
} else if strings.EqualFold(trimmed, dir) {
found = true
}
}
if !found {
return nil
}
newPath := strings.Join(newPaths, ";")
newPathUTF16, _ := syscall.UTF16FromString(newPath)
ret, _, _ = regSetValueEx.Call(
uintptr(hKey),
uintptr(unsafe.Pointer(valueName)),
0,
REG_SZ,
uintptr(unsafe.Pointer(&newPathUTF16[0])),
uintptr(len(newPathUTF16)*2),
)
if ret != 0 {
return fmt.Errorf("å†™å…¥ PATH å¤±è´¥: %d", ret)
}
envPtr, _ := syscall.UTF16PtrFromString("Environment")
sendMessageTimeout.Call(
HWND_BROADCAST,
WM_SETTINGCHANGE,
0,
uintptr(unsafe.Pointer(envPtr)),
SMTO_ABORTIFHUNG,
5000,
0,
)
return nil
}
```


---

> ğŸ“‹ **æç¤º**: è¿˜æœ‰ 9 ä¸ªæ–‡ä»¶æœªå±•ç¤ºï¼Œå†…å®¹å°†åœ¨ä¸‹ä¸€éƒ¨åˆ†ç»§ç»­

